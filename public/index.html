<!DOCTYPE html>
<html>
<head>
  <title>九宫格图片验证码展示</title>
  <style>
    .grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
    }

    .image {
      position: relative;
      width: 100%;
      padding-bottom: 100%;
      background-size: cover;
      background-repeat: no-repeat;
      cursor: pointer;
    }

    .selected {
      border: 2px solid blue;
    }
  </style>
</head>
<body>
  <div class="grid" id="imageGrid"></div>
  <input type="text" id="selectedImages" readonly>
  <script>
    // 发送 API 请求获取图片数据
    fetch('/api/create')
      .then(response => response.json())
      .then(data => {
        if (data.ok) {
          displayImages(data.data);
        }
      })
      .catch(error => {
        console.log(error);
      });

    // 创建图片元素并展示在九宫格中
    function displayImages(images) {
      const imageGrid = document.getElementById('imageGrid');

      images.forEach(imageData => {
        const { base64, id } = imageData;
        const imageElement = document.createElement('div');
        imageElement.classList.add('image');
        imageElement.style.backgroundImage = `url(data:image/jpeg;base64,${base64})`;
        imageElement.dataset.id = id;

        imageElement.addEventListener('click', () => {
          toggleSelection(imageElement);
          updateSelectedImages();
        });

        imageGrid.appendChild(imageElement);
      });
    }

    // 标记或取消标记选定的图片
    function toggleSelection(imageElement) {
      imageElement.classList.toggle('selected');
    }

    // 更新选定图片的输入框
    function updateSelectedImages() {
      const selectedImages = Array.from(document.querySelectorAll('.image.selected'));
      const selectedIds = selectedImages.map(image => image.dataset.id);
      const selectedImagesInput = document.getElementById('selectedImages');
      selectedImagesInput.value = selectedIds.join('|');
    }
  </script>
</body>
</html>
