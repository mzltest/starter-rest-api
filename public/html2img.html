<!DOCTYPE html>
<html>
<head>
  <title>html2img API Demo</title>
</head>
<body>
  <h1>html2img API Demo</h1>
  
  <form id="html2imgForm">
    <label for="url">URL:</label>
    <input type="text" id="url" name="url" placeholder="目标URL"><br><br>
    
    <label for="content">HTML内容:</label><br>
    <textarea id="content" name="content" rows="5" cols="50" placeholder="HTML内容"></textarea><br><br>
    
    <label for="width">浏览器宽度:</label>
    <input type="number" id="width" name="width" placeholder="浏览器宽度"><br><br>
    
    <label for="height">浏览器高度:</label>
    <input type="number" id="height" name="height" placeholder="浏览器高度"><br><br>
    
    <input type="checkbox" id="fullpage" name="fullpage">
    <label for="fullpage">截取整页</label><br><br>
    
    <label for="format">返回格式:</label>
    <select id="format" name="format">
      <option value="jpg">JPG</option>
      <option value="png">PNG</option>
    </select><br><br>
    
    <input type="checkbox" id="looseload" name="looseload">
    <label for="looseload">使用domcontentloaded判定加载完毕（默认是networkIdle0）</label><br><br>
    
    <label for="selector">元素选择器:</label>
    <input type="text" id="selector" name="selector" placeholder="元素选择器"><br><br>
    
    <input type="checkbox" id="selector_strictload" name="selector_strictload">
    <label for="selector_strictload">对于选择器要求networkIdle0后再寻找</label><br><br>
    
    <button type="submit">生成图片</button>
  </form>
  
  <div id="result"></div>
  
  <script>
    document.getElementById('html2imgForm').addEventListener('submit', function(event) {
      event.preventDefault();
      
      var data = {
        url: document.getElementById('url').value,
        content: document.getElementById('content').value,
        width: parseInt(document.getElementById('width').value),
        height: parseInt(document.getElementById('height').value),
        fullpage: document.getElementById('fullpage').checked,
        format: document.getElementById('format').value,
        looseload: document.getElementById('looseload').checked,
        selector: document.getElementById('selector').value,
        selector_strictload: document.getElementById('selector_strictload').checked
      };
      
      fetch('/api/html2img', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(data)
      })
      .then(function(response) {
        return response.blob();
      })
      .then(function(blob) {
        var imageUrl = URL.createObjectURL(blob);
        var img = document.createElement('img');
        img.src = imageUrl;
        document.getElementById('result').appendChild(img);
      })
      .catch(function(error) {
        console.error(error);
        document.getElementById('result').textContent = 'An error occurred while generating the image.';
      });
    });
  </script>
</body>
</html>
